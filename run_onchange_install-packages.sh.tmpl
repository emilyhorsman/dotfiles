#!/bin/bash
# packages.yaml hash: {{ include ".chezmoidata/packages.yaml" | sha256sum }}

<<'DOCUMENTATION'
# Package Installation Script

This script automatically installs packages defined in `.chezmoidata/packages.yaml`
using the appropriate package manager for your operating system.

## Supported Operating Systems

- **macOS**: Uses Homebrew (`brew`)
- **Arch Linux**: Uses pacman

## How it works

1. The script reads the package lists from `.chezmoidata/packages.yaml`
2. Detects your operating system using chezmoi template variables
3. Passes all packages to the package manager in a single command
4. On Arch Linux, installs both global packages and arch-specific packages

## Triggering

This is a `run_onchange` script, which means it runs automatically when:
- The packages.yaml file changes (detected via SHA256 hash)
- You run `chezmoi apply`
DOCUMENTATION

{{ if eq .chezmoi.os "darwin" -}}
echo "Installing packages on macOS using Homebrew..."
brew install {{ range .packages.global }}{{ . }} {{ end }}

{{ else if eq .chezmoi.os "linux" -}}
{{ if eq .chezmoi.osRelease.id "arch" -}}
echo "Installing packages on Arch Linux using pacman..."
sudo pacman -S --noconfirm {{ range .packages.global }}{{ . }} {{ end }}{{ if .packages.arch }}{{ range .packages.arch }}{{ . }} {{ end }}{{ end }}
{{ end -}}
{{ end -}}

echo "Package installation complete!"
